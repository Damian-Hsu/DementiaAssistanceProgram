{
  "功能編號": "2-3",
  "功能名稱": "影片管理",
  "功能說明": "影片管理頁提供錄影清單查詢、關鍵字搜尋（依事件內容過濾）、播放影片、取得下載連結、顯示影片內事件列表與刪除錄影；前端透過 recordings/events API 取得資料與 presigned URL，並以 HTML5 video 播放。",
  "程式名稱": "services/WebUIServer/app/template/recordings.html; services/WebUIServer/app/static/js/recordings.js; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Recordings/service.py; services/APIServer/app/router/Recordings/DTO.py; services/APIServer/app/DataAccess/tables/recordings.py; services/APIServer/app/DataAccess/tables/events.py",
  "輸入": [
    "keywords（可選）",
    "start_time/end_time（可選，YYYY-MM-DD）",
    "sort（-start_time/+start_time 等）",
    "recording_id（播放/刪除/事件列表用）",
    "ttl/disposition/filename/asset_type（取得 URL 用）",
    "Bearer JWT"
  ],
  "輸出": [
    "RecordingListResp（items/total）",
    "RecordingUrlResp（url/ttl/expires_at/thumbnail_url）",
    "EventRead[]（錄影底下事件清單）",
    "刪除結果 OkResp"
  ],
  "INPUT_PROCESS_OUTPUT": {
    "INPUT": [
      {
        "step_no": 1,
        "title": "頁面載入",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "進入影片管理頁（/recordings），載入影片清單"
          },
          {
            "sub_no": "②",
            "item": "若 URL query 含 recording_id，則嘗試自動選取該影片播放"
          }
        ]
      },
      {
        "step_no": 2,
        "title": "使用者操作",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "輸入關鍵字或設定日期範圍以搜尋"
          },
          {
            "sub_no": "②",
            "item": "點選影片清單項目播放"
          },
          {
            "sub_no": "③",
            "item": "點選刪除影片並確認"
          }
        ]
      }
    ],
    "PROCESS": [
      {
        "step_no": 1,
        "title": "資料查詢",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "前端呼叫 GET /api/v1/recordings（keywords/start_time/end_time/sort/page/size）取得錄影清單"
          },
          {
            "sub_no": "②",
            "item": "若影片有 thumbnail_s3_key：前端以 asset_type=thumbnail 呼叫 GET /api/v1/recordings/{id} 取得縮圖 presigned URL"
          }
        ]
      },
      {
        "step_no": 2,
        "title": "播放處理",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "選取影片後呼叫 GET /api/v1/recordings/{id} 取得影片 presigned URL 並設為 video.src"
          },
          {
            "sub_no": "②",
            "item": "同時呼叫 GET /api/v1/recordings/{id}/events 載入影片內事件列表"
          }
        ]
      },
      {
        "step_no": 3,
        "title": "刪除處理",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "使用者確認後呼叫 DELETE /api/v1/recordings/{id}（後端刪除 S3 物件、events、recordings）"
          },
          {
            "sub_no": "②",
            "item": "前端清空播放器並重新載入清單，必要時自動播放新的第一筆影片"
          }
        ]
      }
    ],
    "OUTPUT": [
      {
        "step_no": 1,
        "title": "顯示結果",
        "sub_steps": [
          {
            "sub_no": "①",
            "item": "顯示影片清單、縮圖（若有）、播放畫面、影片資訊與事件列表"
          }
        ]
      }
    ]
  },
  "資料表": {
    "table_name": "recordings; events",
    "columns": [
      {
        "欄位": "id",
        "中文": "錄影ID",
        "型態": "UUID",
        "長度": null,
        "空值": "否",
        "預設值": "uuid7",
        "備註": "recordings.id；Primary Key"
      },
      {
        "欄位": "user_id",
        "中文": "使用者ID",
        "型態": "INTEGER",
        "長度": null,
        "空值": "否",
        "預設值": null,
        "備註": "recordings.user_id"
      },
      {
        "欄位": "s3_key",
        "中文": "影片S3路徑",
        "型態": "TEXT",
        "長度": null,
        "空值": "否",
        "預設值": null,
        "備註": "recordings.s3_key"
      },
      {
        "欄位": "thumbnail_s3_key",
        "中文": "縮圖S3路徑",
        "型態": "TEXT",
        "長度": null,
        "空值": "是",
        "預設值": null,
        "備註": "recordings.thumbnail_s3_key"
      },
      {
        "欄位": "start_time",
        "中文": "開始時間",
        "型態": "TIMESTAMP WITH TIME ZONE",
        "長度": null,
        "空值": "是",
        "預設值": null,
        "備註": "recordings.start_time"
      },
      {
        "欄位": "end_time",
        "中文": "結束時間",
        "型態": "TIMESTAMP WITH TIME ZONE",
        "長度": null,
        "空值": "是",
        "預設值": null,
        "備註": "recordings.end_time"
      },
      {
        "欄位": "id",
        "中文": "事件ID",
        "型態": "UUID",
        "長度": null,
        "空值": "否",
        "預設值": "uuid7",
        "備註": "events.id"
      },
      {
        "欄位": "recording_id",
        "中文": "錄影ID",
        "型態": "UUID",
        "長度": null,
        "空值": "是",
        "預設值": null,
        "備註": "events.recording_id"
      },
      {
        "欄位": "summary",
        "中文": "摘要",
        "型態": "TEXT",
        "長度": null,
        "空值": "是",
        "預設值": null,
        "備註": "events.summary（關鍵字搜尋來源）"
      }
    ]
  }
}
