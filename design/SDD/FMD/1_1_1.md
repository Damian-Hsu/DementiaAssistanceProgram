# 1-1-1 登入

- **功能編號**：1-1-1
- **功能名稱**：登入
- **功能說明**：使用者於登入頁面輸入帳號與密碼送出後，由後端驗證帳號/密碼與帳號啟用狀態，成功則簽發 JWT 存取權杖並回傳；前端收到權杖後寫入 localStorage，並取得目前使用者角色後導向一般使用者首頁或管理員任務頁。
- **程式名稱**：services/WebUIServer/app/template/auth.html; services/WebUIServer/app/static/js/sign_login.js; services/WebUIServer/app/static/js/APIClient.js; services/WebUIServer/app/static/js/AuthService.js; services/APIServer/app/router/Authentication/service.py; services/APIServer/app/router/User/service.py; services/APIServer/app/security/jwt_manager.py
- **輸入**：鍵盤、滑鼠；登入/註冊介面、users資料表
- **輸出**：螢幕；登入/註冊介面、首頁、管理員任務管理介面
- **備註**：使用JWT權杖簽發。

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 鍵盤輸入【帳號】、【密碼】<br>&nbsp;&nbsp;① 【帳號】<br>&nbsp;&nbsp;② 【密碼】 | ❶ 前端檢查帳號格式（6~30 字元、僅允許英數字與 ._、不可含空白） | ❶ 不合法：改變輸入框顏色為紅色 |
| ❷ 滑鼠點選【Log in】 | ❷ 前端檢查是否不合法（同上）；否則送出帳號密碼，後端先進行欄位驗證，再與 users 資料表驗證對應帳密，正確後獲取身分，錯誤則返回「帳號或密碼錯誤」。<br>&nbsp;&nbsp;① 是：提示使用者錯誤<br>&nbsp;&nbsp;② 否：送出登入請求並驗證帳密與帳號狀態 | ❷ 登入成功：進入一般使用者首頁或管理員任務管理介面；登入失敗：顯示錯誤訊息 |

## 資料表

### users

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 使用者ID | INTEGER |  | 否 | autoincrement | Primary Key |
| account | 帳號 | VARCHAR | 50 | 否 |  | 唯一；索引 |
| name | 姓名 | VARCHAR | 100 | 否 |  |  |
| role | 角色 | ENUM |  | 否 | user | RoleEnum（user/admin） |
| gender | 性別 | ENUM |  | 否 |  | GenderEnum |
| birthday | 生日 | DATE |  | 否 |  |  |
| phone | 手機號碼 | VARCHAR | 20 | 否 |  | 唯一；索引 |
| email | 電子郵件 | VARCHAR | 100 | 否 |  | 唯一；索引 |
| headshot_url | 頭像URL | TEXT |  | 是 |  |  |
| password_hash | 密碼雜湊 | VARCHAR | 256 | 否 |  | bcrypt hash |
| active | 帳號啟用狀態 | BOOLEAN |  | 否 | True |  |
| settings | 使用者設定 | JSONB |  | 是 |  |  |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | TimestampMixin；更新時由資料庫 onupdate |
