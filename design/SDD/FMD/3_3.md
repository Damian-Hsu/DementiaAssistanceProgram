# 3-3 音樂庫管理

- **功能編號**：3-3
- **功能名稱**：音樂庫管理
- **功能說明**：管理員可在音樂庫管理頁維護系統音樂資源，包含查看音樂清單、上傳音訊檔、編輯音樂資訊（名稱/製作者/描述/metadata）與刪除音樂。音樂檔會上傳至 MinIO(S3) 並在資料庫 music 表建立紀錄；刪除時會嘗試刪除對應的 S3 物件並刪除資料庫紀錄。
- **程式名稱**：services/WebUIServer/app/template/admin_music.html; services/WebUIServer/app/static/js/admin_music.js; services/WebUIServer/app/static/css/admin_tasks.css; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Music/service.py; services/APIServer/app/router/Music/DTO.py; services/APIServer/app/DataAccess/tables/music.py; services/APIServer/app/utils/s3_utils.py
- **輸入**：系統、滑鼠、鍵盤、檔案；管理員音樂庫管理介面、music資料表
- **輸出**：螢幕、資料庫；管理員音樂庫管理介面、music資料表
- **備註**：僅管理員可使用。

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 系統載入管理員音樂庫管理介面 | ❶ 查詢 music 清單並顯示表格。 | ❶ 顯示音樂清單 |
| ❷ 檔案選擇音樂檔 | ❷ 上傳音樂檔並建立 music 記錄。 | ❷ 新增音樂資料 |
| ❸ 滑鼠點選【刪除音樂】<br>&nbsp;&nbsp;① 【取消】<br>&nbsp;&nbsp;② 【確認】 |  | ❸ 跳出刪除確認視窗 |

## 資料表

### music

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 音樂ID | UUID |  | 否 | uuid7 | music.id；Primary Key |
| name | 音樂名稱 | VARCHAR | 255 | 否 |  | music.name |
| uploader_user_id | 上傳者使用者ID | INTEGER |  | 否 |  | music.uploader_user_id；ForeignKey(users.id)；索引 |
| composer | 製作者 | VARCHAR | 255 | 是 |  | music.composer |
| description | 詳細資訊 | TEXT |  | 是 |  | music.description |
| meta_data | Metadata(JSON) | JSONB |  | 是 |  | music.meta_data |
| content_type | 內容類型 | VARCHAR | 100 | 是 |  | music.content_type（audio/*） |
| s3_key | S3 物件鍵 | TEXT |  | 否 |  | music.s3_key（unique） |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | TimestampMixin；更新時由資料庫 onupdate |
