# 2-2-5 開始串流

- **功能編號**：2-2-5
- **功能名稱**：開始串流
- **功能說明**：使用者點擊開始串流後，前端呼叫 connect 端點建立串流連線；後端簽發 StreamingServer 拉流用的 internal RTSP token 並呼叫 StreamingServer /streams/start 啟動錄影切片，前端同時取得 RTSP 推流 URL 並複製給使用者開始推流，並在串流狀態變為 running 時自動啟動 WebRTC 預覽。
- **程式名稱**：services/WebUIServer/app/static/js/camera.js; services/WebUIServer/app/static/js/services/CameraService.js; services/APIServer/app/router/Camera/service.py; services/StreamingServer/app/main.py
- **輸入**：滑鼠；鏡頭介面
- **輸出**：螢幕；RTSP推流URL、即時預覽畫面

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 滑鼠點選【開始串流】 | ❶ 建立串流連線並啟動錄影切片，取得推流 URL 並進入狀態輪詢。 | ❶ 提示開始推流並顯示預覽狀態 |

## 資料表

### camera; settings

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| status | 鏡頭狀態 | ENUM |  | 否 | inactive | 僅 active 可 connect |
| token_version | Token版本 | INTEGER |  | 否 | 0 | 簽 internal read token |
| key | 設定鍵 | VARCHAR | 100 | 否 |  | settings.key（video_segment_seconds） |
| value | 設定值 | TEXT |  | 否 |  | settings.value（JSON 字串） |
