# 3-1 任務管理

- **功能編號**：3-1
- **功能名稱**：任務管理
- **功能說明**：管理員可在任務管理頁查看全系統背景任務狀態，包含 Compute 任務（來源 inference_jobs）與串流任務（來源 StreamingServer /streams）。支援依狀態/類型篩選、分頁、手動刷新與自動刷新（每 10 秒），並可點擊任務列查看詳情（錯誤訊息、參數/metrics/輸入輸出等）。
- **程式名稱**：services/WebUIServer/app/template/admin_tasks.html; services/WebUIServer/app/static/js/admin_tasks.js; services/WebUIServer/app/static/css/admin_tasks.css; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Admin/service.py; services/APIServer/app/router/Admin/DTO.py; services/APIServer/app/DataAccess/tables/inference_jobs.py; services/StreamingServer/app/main.py
- **輸入**：系統、滑鼠；管理員任務管理介面、inference_jobs資料表
- **輸出**：螢幕；管理員任務管理介面、任務詳情視窗
- **備註**：僅管理員可使用。

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 系統載入管理員任務管理介面 | ❶ 查詢並整合 Compute/串流任務清單。 | ❶ 顯示任務列表 |
| ❷ 滑鼠選擇【任務類型】、【狀態】 | ❷ 依篩選條件重新載入任務列表。 | ❷ 更新任務列表 |
| ❸ 滑鼠點選任務列 |  | ❸ 跳出任務詳情視窗 |

## 資料表

### inference_jobs

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 任務ID | UUID |  | 否 | uuid7 | inference_jobs.id；Primary Key |
| type | 任務類型 | VARCHAR | 128 | 否 |  | inference_jobs.type（會映射為 UI 的 task_type） |
| status | 狀態 | ENUM |  | 否 | pending | inference_jobs.status（JobStatusEnum） |
| input_type | 輸入類型 | VARCHAR | 128 | 否 |  | inference_jobs.input_type |
| input_url | 輸入來源 | TEXT |  | 是 |  | inference_jobs.input_url |
| output_url | 輸出來源 | TEXT |  | 是 |  | inference_jobs.output_url |
| trace_id | 追蹤ID | VARCHAR | 64 | 是 |  | inference_jobs.trace_id；索引 |
| error_message | 錯誤訊息 | TEXT |  | 是 |  | inference_jobs.error_message |
| params | 參數(JSON) | JSONB |  | 是 |  | inference_jobs.params（常見：user_id/camera_id/video_id/progress） |
| metrics | 度量(JSON) | JSONB |  | 是 |  | inference_jobs.metrics（包含耗時/影片資訊/LLM token 等） |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | TimestampMixin；更新時由資料庫 onupdate |
