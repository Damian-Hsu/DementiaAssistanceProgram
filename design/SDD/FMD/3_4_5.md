# 3-4-5 M2M API Key 管理

- **功能編號**：3-4-5
- **功能名稱**：M2M API Key 管理
- **功能說明**：管理員可建立、更新、旋轉與停用 M2M API Key；建立/旋轉時 token 只回傳一次並提示管理員保存。
- **程式名稱**：services/WebUIServer/app/template/admin_settings.html; services/WebUIServer/app/static/js/admin_settings.js; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Admin/service.py; services/APIServer/app/router/Admin/DTO.py; services/APIServer/app/security/api_key_manager.py; services/APIServer/app/DataAccess/tables/api_keys.py; services/APIServer/app/DataAccess/tables/users.py
- **輸入**：滑鼠、鍵盤；管理員系統設定介面、api_keys資料表
- **輸出**：螢幕、資料庫；API Key 列表、api_keys資料表
- **備註**：token 明碼僅在建立/旋轉時回傳一次。

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 鍵盤輸入【名稱】、【擁有者ID】、【Scopes】、【速率限制】、【每日配額】 |  |  |
| ❷ 滑鼠點選【建立 API Key】 | ❷ 建立 api_keys 記錄並回傳一次性 token。 | ❷ 新增API Key |
| ❸ 滑鼠點選【旋轉】<br>&nbsp;&nbsp;① 【取消】<br>&nbsp;&nbsp;② 【確認】 |  | ❸ 跳出旋轉確認視窗 |
| ❸-① 滑鼠點選【取消】 |  | ❸-① 關閉旋轉確認視窗 |
| ❸-② 滑鼠點選【確認】 | ❸-② 旋轉 token 並更新 api_keys.token_hash。 | ❸-② 更新API Key Token |

## 資料表

### api_keys; users

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
