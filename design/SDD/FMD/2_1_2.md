# 2-1-2 顯示日記內容

- **功能編號**：2-1-2
- **功能名稱**：顯示日記內容
- **功能說明**：首頁於指定日期載入時，前端呼叫後端取得該日期日記摘要並顯示於日記區塊；同時查詢當日事件列表並計算事件哈希，供後續自動刷新判斷是否需要更新日記。若該日無事件則顯示提示訊息。
- **程式名稱**：services/WebUIServer/app/template/home.html; services/WebUIServer/app/static/js/diary.js; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Chat/service.py; services/APIServer/app/DataAccess/tables/diary.py; services/APIServer/app/DataAccess/tables/events.py
- **輸入**：系統；日記介面、diary資料表、events資料表
- **輸出**：螢幕；日記介面

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 系統載入日記介面 | ❶ 依目標日期查詢 diary/events 資料並計算事件雜湊供後續比對。 | ❶ 顯示該日日記內容或提示訊息 |

## 資料表

### diary; events

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 日記ID | UUID |  | 否 | uuid7 | diary.id；Primary Key |
| user_id | 使用者ID | INTEGER |  | 否 |  | diary.user_id；ForeignKey(users.id)；索引 |
| diary_date | 日記日期 | DATE |  | 否 |  | diary.diary_date；索引 |
| content | 日記內容 | TEXT |  | 是 |  | diary.content |
| events_hash | 事件列表雜湊 | VARCHAR | 64 | 是 |  | diary.events_hash；索引 |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | diary.created_at；TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | diary.updated_at；TimestampMixin；更新時由資料庫 onupdate |
| id | 事件ID | UUID |  | 否 | uuid7 | events.id；Primary Key |
| user_id | 使用者ID | INTEGER |  | 否 |  | events.user_id；ForeignKey(users.id)；索引 |
| recording_id | 錄影ID | UUID |  | 是 |  | events.recording_id；ForeignKey(recordings.id)；索引 |
| action | 活動 | VARCHAR | 128 | 是 |  | events.action |
| scene | 場景 | VARCHAR | 128 | 是 |  | events.scene |
| summary | 摘要 | TEXT |  | 是 |  | events.summary |
| objects | 物件清單 | ARRAY(VARCHAR) |  | 是 |  | events.objects |
| start_time | 事件開始時間 | TIMESTAMP WITH TIME ZONE |  | 是 |  | events.start_time |
| duration | 事件持續秒數 | FLOAT |  | 是 |  | events.duration |
| embedding | 事件向量 | VECTOR | 1024 | 是 |  | events.embedding（pgvector） |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | events.created_at；TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | events.updated_at；TimestampMixin；更新時由資料庫 onupdate |
