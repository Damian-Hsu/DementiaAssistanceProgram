# 2-2 鏡頭串流

- **功能編號**：2-2
- **功能名稱**：鏡頭串流
- **功能說明**：使用者可在鏡頭頁面新增/編輯/刪除鏡頭，並取得 RTSP 推流 URL 供外部攝影機/OBS 推流；啟動串流時後端會呼叫 StreamingServer 開始錄影切片並回傳狀態，前端會輪詢串流狀態並以 WebRTC（WHEP）播放即時畫面，停止串流需經確認對話框。
- **程式名稱**：services/WebUIServer/app/template/camera.html; services/WebUIServer/app/static/js/camera.js; services/WebUIServer/app/static/js/services/CameraService.js; services/WebUIServer/app/static/js/APIClient.js; services/WebUIServer/app/template/partials/stop_stream_confirm_dialog.html; services/APIServer/app/router/Camera/service.py; services/APIServer/app/router/Camera/DTO.py; services/APIServer/app/DataAccess/tables/camera.py; services/StreamingServer/app/main.py
- **輸入**：系統、滑鼠、鍵盤；鏡頭介面、camera資料表
- **輸出**：螢幕、資料庫；鏡頭介面、即時預覽畫面、camera資料表

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 系統載入鏡頭介面 | ❶ 載入鏡頭清單並輪詢串流狀態。 | ❶ 顯示鏡頭清單與串流狀態 |
| ❷ 滑鼠點選【開始串流】 | ❷ 建立串流連線並提供推流 URL，串流狀態為 running 時啟動即時預覽。 | ❷ 顯示即時預覽畫面 |
| ❸ 滑鼠點選【停止串流】<br>&nbsp;&nbsp;① 【取消】<br>&nbsp;&nbsp;② 【確認】 |  | ❸ 跳出停止確認視窗 |

## 資料表

### camera; settings; users

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 鏡頭ID | UUID |  | 否 | uuid7 | camera.id；Primary Key |
| user_id | 使用者ID | INTEGER |  | 否 |  | camera.user_id；ForeignKey(users.id)；索引 |
| name | 鏡頭名稱 | VARCHAR | 128 | 否 |  | camera.name |
| status | 鏡頭狀態 | ENUM |  | 否 | inactive | camera.status（active/inactive/deleted） |
| path | 串流路徑 | VARCHAR | 64 | 是 |  | camera.path（公開串流 path） |
| token_version | Token版本 | INTEGER |  | 否 | 0 | camera.token_version |
| last_seen_at | 最後上線時間 | TIMESTAMP WITH TIME ZONE |  | 是 |  | camera.last_seen_at |
| max_publishers | 最大推流者數量 | INTEGER |  | 否 | 1 | camera.max_publishers |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | camera.created_at；TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | camera.updated_at；TimestampMixin；更新時由資料庫 onupdate |
