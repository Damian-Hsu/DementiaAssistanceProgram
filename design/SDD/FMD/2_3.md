# 2-3 影片管理

- **功能編號**：2-3
- **功能名稱**：影片管理
- **功能說明**：影片管理頁提供錄影清單查詢、關鍵字搜尋（依事件內容過濾）、播放影片、取得下載連結、顯示影片內事件列表與刪除錄影；前端透過 recordings/events API 取得資料與 presigned URL，並以 HTML5 video 播放。
- **程式名稱**：services/WebUIServer/app/template/recordings.html; services/WebUIServer/app/static/js/recordings.js; services/WebUIServer/app/static/js/APIClient.js; services/APIServer/app/router/Recordings/service.py; services/APIServer/app/router/Recordings/DTO.py; services/APIServer/app/DataAccess/tables/recordings.py; services/APIServer/app/DataAccess/tables/events.py
- **輸入**：系統、鍵盤、滑鼠；影片管理介面、recordings資料表、events資料表
- **輸出**：螢幕、資料庫；影片管理介面、recordings資料表、events資料表

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 系統載入影片管理介面 | ❶ 查詢錄影清單並顯示列表。 | ❶ 顯示錄影清單 |
| ❷ 滑鼠點選錄影項目 | ❷ 取得播放連結並載入事件列表。 | ❷ 播放錄影並顯示事件列表 |
| ❸ 滑鼠點選【刪除影片】<br>&nbsp;&nbsp;① 【取消】<br>&nbsp;&nbsp;② 【確認】 |  | ❸ 跳出刪除確認視窗 |
| ❸-① 滑鼠點選【取消】 |  | ❸-① 關閉刪除確認視窗 |
| ❸-② 滑鼠點選【確認】 | ❸-② 刪除 recordings 與關聯 events 資料。 | ❸-② 刪除錄影與事件資料 |

## 資料表

### recordings; events

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 錄影ID | UUID |  | 否 | uuid7 | recordings.id；Primary Key |
| user_id | 使用者ID | INTEGER |  | 否 |  | recordings.user_id |
| s3_key | 影片S3路徑 | TEXT |  | 否 |  | recordings.s3_key |
| thumbnail_s3_key | 縮圖S3路徑 | TEXT |  | 是 |  | recordings.thumbnail_s3_key |
| start_time | 開始時間 | TIMESTAMP WITH TIME ZONE |  | 是 |  | recordings.start_time |
| end_time | 結束時間 | TIMESTAMP WITH TIME ZONE |  | 是 |  | recordings.end_time |
| id | 事件ID | UUID |  | 否 | uuid7 | events.id |
| recording_id | 錄影ID | UUID |  | 是 |  | events.recording_id |
| summary | 摘要 | TEXT |  | 是 |  | events.summary（關鍵字搜尋來源） |
