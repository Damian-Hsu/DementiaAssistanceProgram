# 1-1-2 註冊

- **功能編號**：1-1-2
- **功能名稱**：註冊
- **功能說明**：使用者於註冊頁面輸入基本資料與密碼送出後，前端先進行格式驗證並送出註冊請求；後端檢查帳號/Email/手機唯一性並建立 users 記錄（含預設 settings），成功後簽發 JWT 並回傳，前端保存 token 後自動導向系統首頁。
- **程式名稱**：services/WebUIServer/app/template/auth.html; services/WebUIServer/app/static/js/sign_login.js; services/WebUIServer/app/static/js/APIClient.js; services/WebUIServer/app/static/js/AuthService.js; services/APIServer/app/router/Authentication/service.py; services/APIServer/app/router/Authentication/DTO.py; services/APIServer/app/router/User/service.py; services/APIServer/app/security/jwt_manager.py
- **輸入**：鍵盤、滑鼠；登入/註冊介面、users資料表
- **輸出**：螢幕；登入/註冊介面、首頁
- **備註**：使用JWT權杖簽發。

## INPUT / PROCESS / OUTPUT

| INPUT | PROCESS | OUTPUT |
|---|---|---|
| ❶ 鍵盤輸入【帳號】、【姓名】、【性別】、【生日】、【手機】、【Email】、【密碼】、【確認密碼】<br>&nbsp;&nbsp;① 【帳號】<br>&nbsp;&nbsp;② 【姓名】<br>&nbsp;&nbsp;③ 【性別】<br>&nbsp;&nbsp;④ 【生日】<br>&nbsp;&nbsp;⑤ 【手機】<br>&nbsp;&nbsp;⑥ 【Email】<br>&nbsp;&nbsp;⑦ 【密碼】<br>&nbsp;&nbsp;⑧ 【確認密碼】 | ❶ 前端檢查欄位格式（帳號/密碼長度與允許字元、Email 格式、手機格式），並檢查兩次密碼一致性。 | ❶ 不合法：提示使用者錯誤並標示欄位 |
| ❷ 滑鼠點選【下一步 Next】 | ❷ 前端送出註冊資料；後端驗證欄位並檢查 users 資料表（account/email/phone）唯一性，通過後寫入 users 資料表並簽發 JWT。<br>&nbsp;&nbsp;① 失敗：帳號/Email/手機已存在或欄位驗證失敗<br>&nbsp;&nbsp;② 成功：建立 users 記錄並回傳 access_token | ❷ 註冊成功：進入首頁；註冊失敗：顯示錯誤訊息 |

## 資料表

### users

| 欄位 | 中文 | 型態 | 長度 | 空值 | 預設值 | 備註 |
|---|---|---|---:|---|---|---|
| id | 使用者ID | INTEGER |  | 否 | autoincrement | Primary Key |
| account | 帳號 | VARCHAR | 50 | 否 |  | 唯一；索引 |
| name | 姓名 | VARCHAR | 100 | 否 |  |  |
| role | 角色 | ENUM |  | 否 | user | RoleEnum（user/admin） |
| gender | 性別 | ENUM |  | 否 |  | GenderEnum（male/female） |
| birthday | 生日 | DATE |  | 否 |  |  |
| phone | 手機號碼 | VARCHAR | 20 | 否 |  | 唯一；索引 |
| email | 電子郵件 | VARCHAR | 100 | 否 |  | 唯一；索引 |
| headshot_url | 頭像URL | TEXT |  | 是 |  |  |
| password_hash | 密碼雜湊 | VARCHAR | 256 | 否 |  | bcrypt hash |
| active | 帳號啟用狀態 | BOOLEAN |  | 否 | True |  |
| settings | 使用者設定 | JSONB |  | 是 |  | 建立時寫入預設設定 |
| created_at | 建立時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 否 | timezone('UTC', now()) | TimestampMixin |
| updated_at | 更新時間(UTC) | TIMESTAMP WITH TIME ZONE |  | 是 |  | TimestampMixin；更新時由資料庫 onupdate |
