# 2-2-7 顯示串流狀態

# Mermaid
```mermaid
sequenceDiagram
  actor User
  participant Browser
  participant WebUIServer
  participant APIServer
  participant StreamingServer

  User ->> Browser: 開啟鏡頭頁/選取鏡頭卡片

  loop 定期查詢（每 N 秒，假設）
    Browser ->> WebUIServer: GET /bff/v1/camera/{id}/stream/status\nAuthorization: Bearer jwt
    WebUIServer ->> APIServer: GET /api/v1/camera/{id}/stream/status
    APIServer ->> StreamingServer: GET /streams\n(X-Internal-Token)
    StreamingServer -->> APIServer: 200 streams[]
    APIServer -->> WebUIServer: 200 {status,is_streaming,stream_info,error_message?}
    WebUIServer -->> Browser: 200 ...

    alt status == running
      Browser ->> Browser: 顯示「串流中」\n可啟動/維持預覽
    else status == starting
      Browser ->> Browser: 顯示「啟動中」\n等待 running
    else status == reconnecting
      Browser ->> Browser: 顯示「重連中」\n可維持預覽或暫停（假設）
    else status == error
      Browser ->> Browser: 顯示錯誤訊息\n提供重試/停止（假設）
    else stopped
      Browser ->> Browser: 顯示「未串流」\n停止預覽
    end
  end
```

## Mermaid 備註
- APIServer 狀態彙整：實際是呼叫 `StreamingServer /streams` 找到 `(user_id,camera_id)` 對應的 stream，並回傳其 `status`。\n- StreamingServer 狀態：包含 `starting/running/reconnecting/error/stopped`（參考 `services/StreamingServer/app/manager.py`）。\n- 缺少的關鍵資訊：前端輪詢間隔 N 秒、以及「reconnecting」時是否仍維持播放器連線，屬 UI 策略；本圖以假設表示。\n+

