# 2-5-3 顯示回覆與關聯資料

# Mermaid
```mermaid
sequenceDiagram
  actor User
  participant Browser
  participant WebUIServer
  participant APIServer
  participant Postgres
  participant Minio

  Browser ->> WebUIServer: POST /bff/v1/chat/\n{message,...}\nAuthorization: Bearer jwt
  WebUIServer ->> APIServer: POST /api/v1/chat/
  APIServer ->> Postgres: （工具查詢）events/recordings/diaries/vlogs
  Postgres -->> APIServer: datasets
  APIServer -->> WebUIServer: 200 ChatResponse\n含 related: events/recordings/diaries/vlogs
  WebUIServer -->> Browser: 200 ...

  Browser ->> Browser: 顯示 AI 回覆文字
  Browser ->> Browser: 依關聯資料筆數\n顯示預覽清單/按鈕

  opt 點選錄影關聯資料 → 播放
    User ->> Browser: 點選某錄影
    Browser ->> WebUIServer: GET /bff/v1/recordings/{id}?ttl=900&disposition=inline\nAuthorization: Bearer jwt
    WebUIServer ->> APIServer: GET /api/v1/recordings/{id}
    APIServer ->> Minio: 產生 presigned URL
    Minio -->> APIServer: url
    APIServer -->> WebUIServer: 200 {url}
    WebUIServer -->> Browser: 200 {url}
    Browser ->> Browser: 開啟播放視窗/播放器播放
  end

  opt 點選 Vlog 關聯資料 → 播放
    User ->> Browser: 點選某 Vlog
    Browser ->> WebUIServer: GET /bff/v1/vlogs/{id}/url?ttl=3600\nAuthorization: Bearer jwt
    WebUIServer ->> APIServer: GET /api/v1/vlogs/{id}/url
    APIServer ->> Minio: 產生 presigned URL
    Minio -->> APIServer: url
    APIServer -->> WebUIServer: 200 {url}
    WebUIServer -->> Browser: 200 {url}
    Browser ->> Browser: 播放 Vlog
  end
```

## Mermaid 備註
- 後端 `ChatResponse` 會帶回「關聯資料」集合，前端依數量呈現預覽與操作入口。\n- 關聯資料的播放實際仍透過既有 API：錄影用 `/recordings/{id}`，Vlog 用 `/vlogs/{id}/url`。\n- 缺少的關鍵資訊：關聯資料 UI 的呈現門檻（多少筆顯示按鈕/清單）屬前端設計，本圖不硬編規則（假設）。\n+

