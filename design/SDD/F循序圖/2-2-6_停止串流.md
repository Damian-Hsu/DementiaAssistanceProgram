# 2-2-6 停止串流

# Mermaid
```mermaid
sequenceDiagram
  actor User
  participant Browser
  participant WebUIServer
  participant APIServer
  participant StreamingServer

  User ->> Browser: 點選【停止串流】
  Browser ->> Browser: 顯示停止確認視窗

  alt 取消/點擊視窗外/按 ESC
    User ->> Browser: 關閉對話框
    Browser ->> Browser: close()\n不停止串流
  else 確認停止
    User ->> Browser: 點選【確認停止】
    Browser ->> WebUIServer: POST /bff/v1/camera/{id}/stream/stop\nAuthorization: Bearer jwt
    WebUIServer ->> APIServer: POST /api/v1/camera/{id}/stream/stop
    APIServer ->> StreamingServer: POST /streams/stop\n{user_id,camera_id}\n(X-Internal-Token)
    StreamingServer ->> StreamingServer: 停止 FFmpeg 拉流/切片
    StreamingServer -->> APIServer: 200 {ok:true}
    APIServer -->> WebUIServer: 200 {ok:true}
    WebUIServer -->> Browser: 200 {ok:true}
    Browser ->> Browser: 停止預覽播放\n更新狀態為 stopped
  end
```

## Mermaid 備註
- 前端確認對話框模板：`services/WebUIServer/app/template/partials/stop_stream_confirm_dialog.html`。\n- 停止端點：`POST /camera/{id}/stream/stop` 由 APIServer 轉呼叫 StreamingServer `POST /streams/stop`。\n+

