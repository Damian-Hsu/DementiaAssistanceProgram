# 3-4-4 影片參數

# Mermaid
```mermaid
sequenceDiagram
  actor Admin
  participant Browser
  participant WebUIServer
  participant APIServer
  participant Postgres

  Admin ->> Browser: 開啟【管理員設定】頁
  Browser ->> WebUIServer: GET /admin/settings
  WebUIServer -->> Browser: 200 admin_settings.html + admin_settings.js

  Admin ->> Browser: 點選【載入現有設定】
  Browser ->> WebUIServer: GET /bff/v1/admin/settings/video-params
  Note over Browser,WebUIServer: Authorization: Bearer jwt
  WebUIServer ->> APIServer: GET /api/v1/admin/settings/video-params
  APIServer ->> Postgres: SELECT settings(video_segment_seconds)
  APIServer -->> WebUIServer: 200 {segment_seconds}
  WebUIServer -->> Browser: 200
  Browser ->> Browser: 填入切片長度

  Admin ->> Browser: 輸入【切片長度(秒)】
  Admin ->> Browser: 點選【儲存設定】
  Browser ->> WebUIServer: POST /bff/v1/admin/settings/video-params
  Note over Browser,WebUIServer: body: {segment_seconds}
  WebUIServer ->> APIServer: POST /api/v1/admin/settings/video-params

  alt 超出範圍（1~600）
    APIServer -->> WebUIServer: 400 {detail}
    WebUIServer -->> Browser: 400
    Browser ->> Browser: 顯示錯誤提示
  else 更新成功
    APIServer ->> Postgres: UPSERT settings.key=video_segment_seconds
    Postgres -->> APIServer: commit
    APIServer -->> WebUIServer: 200 {segment_seconds}
    WebUIServer -->> Browser: 200
    Browser ->> Browser: 顯示成功提示
  end
```

## Mermaid 備註
- API：`GET/POST /bff/v1/admin/settings/video-params`。
- 寫入位置：`settings.key = video_segment_seconds`（value 為 JSON：`{"segment_seconds":30}`）。
- 使用位置：Streaming/錄影切片會以此值作為每段影片切片長度。
