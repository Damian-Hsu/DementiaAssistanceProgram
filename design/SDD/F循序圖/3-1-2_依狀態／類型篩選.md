# 3-1-2 依狀態/類型篩選

# Mermaid
```mermaid
sequenceDiagram
  actor Admin
  participant Browser
  participant WebUIServer
  participant APIServer
  participant Postgres
  participant StreamingServer

  Admin ->> Browser: 選擇【任務類型】或【狀態】
  Browser ->> Browser: 更新 filters + pageNow=1

  Browser ->> WebUIServer: GET /bff/v1/admin/tasks?task_type={t}&status_filter={s}&page=1&size=20
  Note over Browser,WebUIServer: Authorization: Bearer jwt
  WebUIServer ->> APIServer: GET /api/v1/admin/tasks?... 

  alt task_type/status_filter 屬於 Compute 任務
    APIServer ->> Postgres: SELECT inference_jobs WHERE type/status 條件
    Postgres -->> APIServer: jobs[]
    opt 同時也查 streaming（除非 filters 指定為 compute-only）
      APIServer ->> StreamingServer: GET /streams
      StreamingServer -->> APIServer: streams[]
    end
  else task_type/status_filter 指向 streaming
    APIServer ->> StreamingServer: GET /streams
    StreamingServer -->> APIServer: streams[]
    Note over APIServer: 若 filters 指定 streaming 狀態，會跳過 compute 查詢
  end

  APIServer ->> APIServer: 合併/排序/分頁
  APIServer -->> WebUIServer: 200 {items,...}
  WebUIServer -->> Browser: 200
  Browser ->> Browser: 更新任務表格
```

## Mermaid 備註
- 篩選參數：前端送 `task_type`、`status_filter`、`page`、`size`（參考 `ApiClient.admin.tasks.list()`）。
- 類型映射（Compute ↔ UI）：例如 `video_description` ↔ DB `video_description_extraction`（後端在 `/admin/tasks` 做雙向 mapping）。
