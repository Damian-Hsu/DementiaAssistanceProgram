# 2-1-5-5 背景音樂設定

# Mermaid
```mermaid
sequenceDiagram
  actor User
  participant Browser
  participant WebUIServer
  participant APIServer
  participant Postgres
  participant Minio

  User ->> Browser: 在 Vlog 設定視窗選擇「背景音樂」
  Browser ->> WebUIServer: GET /bff/v1/music?skip=0&limit=100\nAuthorization: Bearer jwt
  WebUIServer ->> APIServer: GET /api/v1/music?skip=0&limit=100
  APIServer ->> Postgres: SELECT music list
  Postgres -->> APIServer: music[]
  APIServer -->> WebUIServer: 200 {items:[...]}
  WebUIServer -->> Browser: 200 ...
  Browser ->> Browser: 顯示音樂清單

  opt 預覽音樂片段（假設：可播放）
    User ->> Browser: 點選音樂「播放/預覽」
    Browser ->> WebUIServer: GET /bff/v1/music/{musicId}/url?ttl=3600\nAuthorization: Bearer jwt
    WebUIServer ->> APIServer: GET /api/v1/music/{musicId}/url
    APIServer ->> Minio: 產生 presigned URL (音樂檔)
    Minio -->> APIServer: presigned URL
    APIServer -->> WebUIServer: 200 {url}
    WebUIServer -->> Browser: 200 {url}
    Browser ->> Browser: 播放音樂預覽
  end

  User ->> Browser: 設定 music_start/music_end\nmusic_fade/music_volume（可選）
  Browser ->> Browser: 更新本地 payload\n供 2-1-5-6 送出使用
```

## Mermaid 備註
- 音樂清單：`GET /bff/v1/music`；音樂播放 URL：`GET /bff/v1/music/{id}/url`（MinIO 預簽名 URL）。\n- 缺少的關鍵資訊：前端是否提供「裁切範圍 UI（start/end）」與其單位/範圍限制；本圖以 payload 欄位抽象表示（假設：秒）。\n+

