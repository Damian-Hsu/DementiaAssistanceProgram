# 2-3-1 影片列表查詢

# Mermaid
```mermaid
sequenceDiagram
  actor User
  participant Browser
  participant WebUIServer
  participant APIServer
  participant Postgres

  User ->> Browser: 開啟影片管理頁\n或調整篩選條件
  Browser ->> WebUIServer: GET /bff/v1/recordings/?page=1&size=20&sort=-start_time\nAuthorization: Bearer jwt
  WebUIServer ->> APIServer: GET /api/v1/recordings/?...
  APIServer ->> Postgres: SELECT recordings\nWHERE user_id=current_user\nORDER BY start_time DESC\nLIMIT/OFFSET
  Postgres -->> APIServer: recordings[] + total
  APIServer -->> WebUIServer: 200 {items,total}
  WebUIServer -->> Browser: 200 ...
  Browser ->> Browser: 過濾無效 start_time（若有）\n渲染清單

  alt token 無效/過期
    APIServer -->> WebUIServer: 401/403
    WebUIServer -->> Browser: 401/403
    Browser ->> Browser: 清除 jwt 並導向登入頁
  end
```

## Mermaid 備註
- API：`GET /bff/v1/recordings/`（支援 `page/size/sort/start_time/end_time` 等參數）。\n- 權限：後端會以 JWT 的 current_user 限制只能查自己的錄影。\n- 缺少的關鍵資訊：`recordings.js` 的實際預設排序/過濾規則可能依 UI 狀態變化；本圖以 `sort=-start_time` 抽象表示。\n+

