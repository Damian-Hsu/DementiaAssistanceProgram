logLevel: info

# 給 Web 前端的輸出
hls: yes
hlsAddress: :8888              # 內部端口（容器內使用）
hlsVariant: lowLatency         # 開 LL-HLS
hlsSegmentDuration: 2s         # 切片 2s
hlsPartDuration: 200ms         # 部分切片 200ms
hlsSegmentCount: 8
# hlsDeleteSegments: yes         # 刪舊片，避免播放清單太長

# RTSP 配置（使用內部端口）
rtspAddress: :8554            # 內部端口（容器內使用）

# WebRTC 配置
webrtc: yes
webrtcAddress: :8889          # 內部端口（容器內使用）
# 關鍵修復：設置為 localhost，讓 MediaMTX 返回可從瀏覽器訪問的 IP
# 同時設置外部端口，讓 MediaMTX 知道外部訪問時使用的端口
webrtcAdditionalHosts: [localhost, 127.0.0.1]
# 本地開發環境：不設置 webrtcLocalTCPAddress，讓 MediaMTX 自動處理
# webrtcLocalTCPAddress 留空，使用默認的 UDP 連接
webrtcEncryption: no             # 本地開發可以關閉加密以減少連接問題
webrtcAllowOrigin: "*"           # 允許所有來源（開發環境）
# WebRTC ICE UDP 端口配置
# 使用內部端口 8189（容器內使用），Docker 會映射到外部端口 30205
webrtcLocalUDPAddress: :8189     # ICE UDP 端口（內部端口）
# 增加 WebRTC 連接超時時間（默認 10 秒，增加到 90 秒）
webrtcHandshakeTimeout: 90s      # 增加握手超時時間，給 ICE 更多時間建立連接
# 關鍵修復：啟用從網絡接口獲取 IP，但優先使用 webrtcAdditionalHosts
# 這樣 MediaMTX 會返回 localhost 作為候選，同時也包含其他可用的 IP
webrtcIPsFromInterfaces: yes     # 從網絡接口獲取 IP，但 webrtcAdditionalHosts 優先
# 嘗試使用環境變數來指定外部端口（如果 MediaMTX 支持）
# 注意：MediaMTX 可能不支持直接指定外部端口，需要通過其他方式解決
# 注意：不設置 webrtcLocalTCPAddress，讓 MediaMTX 自動處理 TCP 回退
# 讓 APIServer 決定誰能 publish/read
authMethod: http
authHTTPAddress: http://api:30000/api/v1/m2m/check-stream-pwd?api-key=0bZWuqcN8okMP9AA9tY3ZoU9ifaSy0k1Fox5S7qjhNF-4KVaDIz6jRwH4qRYFl3P
authHTTPExclude:
  - action: api
  - action: metrics
  - action: pprof



# # 套用到所有 path 的預設（動態）
# pathDefaults:
#   record: yes
#   recordPath: /recordings/%path/%Y/%m/%d/%Y%m%dT%H%M%SZ
#   recordSegmentDuration: 30s   # 30 秒一段（相對切法）
#   # 若要完全對齊牆鐘，下面用 FFmpeg 方案代替錄影

metrics: yes
metricsAddress: :9998

paths:
  all:
    source: publisher